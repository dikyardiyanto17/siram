<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="icon" type="image/png" href="/favicon.png">
    <link rel="stylesheet" href="/assets/plugins/datatable/datatables.min.css">
    <link rel="stylesheet" href="/assets/css/room_siram_detail.css">
    <link rel="stylesheet" href="/assets/css/custom_datatable_room_detail.css">
    <link rel="stylesheet" href="/assets/css/custom_datatable.css">
    <link href='https://fonts.googleapis.com/css?family=Plus Jakarta Sans' rel='stylesheet'>
    <link href='https://fonts.googleapis.com/css?family=Roboto' rel='stylesheet'>
    <title>Telepati</title>
</head>

<body>
    <div class="full-container">
        [/- include('../../../partial/header') /]
        <div id="loading-id" class="loading-show">
            <img src="/assets/pictures/loading.svg" alt="loading-bar" />
        </div>
        <div class="main-container">
            <div class="main-container-wrapper">
                <div class="main-content-wrapper">
                    <div class="header-detail">
                        <span>Detail Rapat</span>
                        <hr>
                    </div>
                    <div class="meeting-detail">
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Tipe Rapat</span></div>
                            <div class="text-detail-input-wrapper">
                                <span>[/= meeting_type == 1 ? "Perkara":"Non Perkara"/]</span>
                            </div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Waktu Mulai</span></div>
                            <div class="text-detail-input-time">
                                <div class="text-detail-input-time-wrapper"><img style="width: 13px;"
                                        src="/assets/icons/date-icon.svg" alt="calender" srcset="">&nbsp;
                                    <span>[/= startDate/]</span>
                                </div>
                                <div class="text-detail-input-time-wrapper"><img style="width: 13px;"
                                        src="/assets/icons/clock_meeting.svg" alt="clock" srcset="">&nbsp;
                                    <span>[/= startTime/]</span>
                                </div>
                            </div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>No Perkara</span></div>
                            <div class="text-detail-input-wrapper"><span>-</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Waktu Selesai</span></div>
                            <div class="text-detail-input-time">
                                <div class="text-detail-input-time-wrapper"><img style="width: 13px;"
                                        src="/assets/icons/date-icon.svg" alt="calender" srcset="">&nbsp;
                                    <span>[/= endDate/]</span>
                                </div>
                                <div class="text-detail-input-time-wrapper"><img style="width: 13px;"
                                        src="/assets/icons/clock_meeting.svg" alt="clock" srcset="">&nbsp;<span>[/=
                                        endTime/]</span></div>
                            </div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Judul Rapat</span></div>
                            <div class="text-detail-input-wrapper"><span>[/= room_name/]</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Jumlah Peserta</span></div>
                            <div class="text-detail-input-wrapper"><span>[/= meeting_type == 1 ? participants.length :
                                    "Publik"/]</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>ID Room</span></div>
                            <div class="text-detail-input-wrapper"><span>[/= room_id/]</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Password</span></div>
                            <div class="text-detail-input-wrapper"><span>[/= password/]</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Face Recognition</span></div>
                            <div class="text-detail-input-wrapper"><span>
                                    [/= face_recognition == 1 ? "Ya" : "Tidak"/]</span></div>
                        </div>
                        <div class="detail-wrapper">
                            <div class="text-detail-wrapper"><span>Keterangan</span></div>
                            <div class="text-detail-input-wrapper"><span>
                                    [/= note || note.trim() != "" ? note : "-"/]</span></div>
                        </div>
                        <div style="position: relative;">
                            <div id="clipboard-success"><span>Copied</span></div>
                            <button type="button" id="clipboard-button"><i class="far fa-copy"></i>&nbsp;Copy
                                Link</button>
                        </div>
                    </div>

                    [/ if (meeting_type == 1) { /]
                    <div class="meeting-participant">
                        <div class="meeting-participant-header">
                            <span>Daftar Peserta</span>
                            <hr>
                        </div>
                        <div class="table-responsive" style="height: 500px;">
                            <table class="table" id="customize-table">
                                <thead>
                                    <tr>
                                        <th>No</th>
                                        <th>ID Peserta</th>
                                        <th>Nama Peserta</th>
                                        <th>Status Peserta</th>
                                        <th>Pengecualian</th>
                                        <th>Status Kehadiran</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    [/ participants.forEach((participant, index) => { /]
                                    <tr>
                                        <td>[/= index+1 /]</td>
                                        <td>[/= participant.participant_id /]</td>
                                        <td>[/= participant.full_name/]</td>
                                        <td>[/= participant.role /]</td>
                                        <td>[/= participant.exception == 1 ? "Ya":"Tidak" /]</td>
                                        <td>[/= participant.status == 1? "Hadir" : "Tidak Hadir"/]</td>
                                    </tr>
                                    [/ }) /]
                                </tbody>
                            </table>
                        </div>
                    </div>
                    [/ } /]
                    <div class="chat-history">
                        <div class="chat-history-header">
                            <span>Riwayat Pesan</span>
                            <hr>
                        </div>
                        <div class="chat-history-content">
                            <div class="chat-content">
                                [/ let previousMessage = null /]
                                [/ messages.forEach((message, index) => { /]
                                [/ let isSame = false /]
                                [/ let isSameTime = false /]

                                [/ if (messages[index+1] && messages[index+1].participant_id == message.participant_id
                                && new Date(message.sent_at).toLocaleTimeString("id-ID", { hour: "2-digit", minute:
                                "2-digit", hour12: true, }) == new
                                Date(messages[index+1].sent_at).toLocaleTimeString("id-ID", { hour: "2-digit", minute:
                                "2-digit", hour12: true, })){/]
                                [/ isSameTime = false /]
                                [/ } else {/]
                                [/ isSameTime = true /]
                                [/ } /]

                                [/ if (previousMessage != null && previousMessage.participant_id ==
                                message.participant_id){ /]
                                [/ isSame = true /]
                                [/ } /]

                                [/ if (participant_id == message.participant_id){ /]
                                <div class="message-container-send">
                                    <img class="chat-photo-profile [/= isSame ? 'invisible' : 'visible'/]"
                                        src="/photo/[/= message.photo_path/].png" alt="photo_profile">

                                    <div class="message-container">
                                        [/ if (!isSame){/]
                                        <div class="chat-name">
                                            <span>[/= message.full_name/]</span>
                                        </div>
                                        [/ }/]
                                        <div class="message">
                                            <div class="message-content">
                                                <span>[/= message.message_text/]</span>
                                            </div>
                                            [/ if (isSameTime){/]
                                            <div class="message-time">
                                                <span>[/= new Date(message.sent_at).toLocaleTimeString("id-ID", { hour:
                                                    "2-digit", minute: "2-digit", hour12: true, }) /]</span>
                                            </div>
                                            [/ }/]
                                        </div>
                                    </div>
                                </div>
                                [/ } else { /]
                                <div class="message-container-receive">
                                    <img class="chat-photo-profile [/= isSame ? 'invisible' : 'visible'/]"
                                        src="/photo/[/= message.photo_path/].png" alt="photo_profile">
                                    <div class="message-container">
                                        [/ if (!isSame){ /]
                                        <div class="chat-name">
                                            <span>[/= message.full_name/]</span>
                                        </div>
                                        [/ }/]

                                        <div class="message">
                                            <div class="message-content">
                                                <span>[/= message.message_text/]</span>
                                            </div>

                                            [/ if (isSameTime){/]


                                            <div class="message-time">
                                                <span>[/= new Date(message.sent_at).toLocaleTimeString("id-ID", { hour:
                                                    "2-digit", minute: "2-digit", hour12: true, }) /]</span>
                                            </div>

                                            [/ } /]

                                        </div>
                                    </div>
                                </div>
                                [/ } /]
                                [/ previousMessage = message /]
                                [/ }) /]

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>
    <script src="/assets/plugins/jquery/jquery-3.7.1.min.js"></script>
    <script src="/assets/plugins/datatable/datatables.min.js"></script>
    <script src="/javascript/url/url.js"></script>
    <script>
        const backButton = [/- JSON.stringify(backButton) /];
        const participants = [/- JSON.stringify(participants) /];
        const messages = [/- JSON.stringify(messages) /];
        const roomId = [/- JSON.stringify(room_id) /];
        const password = [/- JSON.stringify(password) /];
    </script>
    <script src="/javascript/room_siram_detail/room_siram_detail.js"></script>

</body>

</html>